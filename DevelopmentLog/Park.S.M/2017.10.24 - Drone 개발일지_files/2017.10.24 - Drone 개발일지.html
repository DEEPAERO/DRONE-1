<html>
<head>
  <title>2017.10.24 - Drone 개발일지</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (ko-KR, DDL); Windows/10.0.15063 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="313"/>
<h1>2017.10.24 - Drone 개발일지</h1>

<div>
<span><div style="text-align: center;"><span style="font-size: 24pt;"><font face="Segoe UI Symbol">2017.10.24 - Drone 개발일지</font></span></div><div style="text-align: right;"><span style="font-size: 12pt;"><font face="Segoe UI Symbol">대덕SW마이스터고 박상민</font></span></div><div style="text-align: left;"><div><font face="Segoe UI Symbol"><br/></font></div></div><div style="text-align: left;"><ul><li><font face="Segoe UI Symbol"><span style="font-size: 12pt; line-height: 23px;">목표 : </span><span style="font-size: 12pt; line-height: 23px;">Drone 조종기에서로부터 오는 각 채널의 데이터를 분류, 검사하고, 데이터 셋에 맞게 디코딩 하기 + 프로그램 테스트(데이터 분석, 디코딩 등</span><span style="font-size: 12pt; line-height: 23px;">)</span></font></li></ul><div style="text-align: left;"><div><font face="Segoe UI Symbol"><br/></font></div></div><ul><li><font face="Segoe UI Symbol" style="font-size: 12pt;"><span style="font-size: 12pt; line-height: 23px;">오늘 한 일</span></font></li><ul><li><span style="font-size: 12pt; line-height: 23px;"><font face="Segoe UI Symbol">조종기로부터 오는 데이터를 UART1으로 받고, UART2로 Print 해주는 기능 구현</font></span></li><li><span style="font-size: 12pt; line-height: 23px;"><font face="Segoe UI Symbol">void sbus_data_filtering() 함수 구현</font></span></li><ul><li><span style="font-size: 12pt; line-height: 23px;"><font face="Segoe UI Symbol">sbus data를 Start byte와 End byte를 구분하여 데이터 패킷(온전한 데이터 1셋 - ch1~ch16 + flags byte)을 잡아내고 void sbus_data_decoding() 함수로 넘겨줌</font></span></li><li><span style="font-size: 12pt; line-height: 23px;"><font face="Segoe UI Symbol">조종기와 통신하는 과정에서 생기는 여러 문제발생의 여지들을 없애기 위한 알고리즘 구현</font></span></li><ul><li><font face="Segoe UI Symbol" style="font-size: 12pt;"><span style="font-size: 12pt; line-height: 23px;">sbus_data_filtering() 함수에서 위 문제점을 보완</span></font></li><li><font face="Segoe UI Symbol" style="font-size: 12pt;"><span style="font-size: 12pt; line-height: 23px;">UART1 Interrupt 함수(<span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 12pt; line-height: 23px;">HAL_UART_RxCpltCallback</span><span style="font-size: 12pt; line-height: 23px;">)</span><span style="font-size: 12pt; line-height: 23px;">에서 1Byte씩 데이터를 입력받고 buffer에 넣어줌</span></span></span></font></li><li style="orphans: 2; widows: 2;"><font face="Segoe UI Symbol" style="font-size: 12pt;"><span style="vertical-align: sub; font-size: 12pt; line-height: 23px;">sbus_data_filtering() 함수에서 buffer[0]에 Start byte를 확인</span><span style="vertical-align: sub; font-size: 12pt; line-height: 23px;">-&gt; 만약 (buffer[0] == 0x0f) 가 확인되면</span></font></li><li style="orphans: 2; widows: 2;"><font face="Segoe UI Symbol" style="font-size: 12pt;"><span style="vertical-align: sub; font-size: 12pt; line-height: 23px;">24개의 데이터를 1byte씩 더 받고, buffer[24]에 End byte를 확인 -&gt; (buffer[24]&amp;0x0f == 0x04) - end byte가 0x04, 0x14, 0x34 ... 로 나오기 때문에 상위 4비트를 0000으로 AND연산 </span></font></li><li style="orphans: 2; widows: 2;"><span style="font-size: 12pt; line-height: 23px;"><font face="Segoe UI Symbol">start byte와 end byte를 체크하고 확인하는 과정에서 buffer index, flag변수도 체크</font></span></li><li style="orphans: 2; widows: 2;"><font face="Segoe UI Symbol" style="font-size: 12pt;"><span style="font-size: 12pt; line-height: 23px;">start byte 와 end byte를 제외한 data들을 sbus_buffer에 저장 </span></font></li><li><span style="font-size: 12pt;"><font face="Segoe UI Symbol">sbus_data_filtering() -&gt; sbus_data_decoding()</font></span></li></ul></ul></ul></ul><div style="text-align: left;"><div><font face="Segoe UI Symbol"><br/></font></div></div><ul style="font-size: 12pt;"><li style="font-size: 12pt;"><span style="font-size: 12pt; line-height: 1.45;"><font face="Segoe UI Symbol">void sbus_data_decoding() 함수 구현</font></span></li><ul><li><span style="font-size: 12pt; line-height: 1.45;"><font face="Segoe UI Symbol">sbus_buffer를 이용하여 decoding</font></span></li><li><span style="font-size: 12pt; line-height: 1.45;"><font face="Segoe UI Symbol">각 ch의 데이터 bit는 11 bit이다. - S-BUS protocol pdf 참고</font></span></li><li><span style="font-size: 12pt; line-height: 1.45;"><font face="Segoe UI Symbol">비트 연산을 이용하여 ch 데이터를 만들어줌</font></span></li><li><span style="font-size: 12pt; line-height: 1.45;"><font face="Segoe UI Symbol">ch1 ~ ch7까지 data를 UART2로 print -&gt; 'Tera term' 터미널을 사용하여 ch값을 확인</font></span></li><li><span style="font-size: 12pt; line-height: 1.45;"><font face="Segoe UI Symbol">각 채널마다 352 ~ 1696의 값 범위</font></span></li></ul><li><a href="2017.10.24 - Drone 개발일지_files/sbus.pdf"><img src="2017.10.24 - Drone 개발일지_files/909fcd10674b1b954e6809ed71f5bfc6.png" alt="sbus.pdf"></a></li></ul><div style="text-align: left;"><div><font face="Segoe UI Symbol"><br/></font></div></div><ul><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">Test 진행</font></span></li><ul><li><font face="Segoe UI Symbol" style="font-size: 12pt;"><span style="line-height: 23px;">설계한 알고리즘이 제대로 작동하는지 판별하기위해 임의로 buffer를 만들고, 10번에 한번씩 버퍼를 입력받아 filtering, decoding을 진행</span><br/></font></li><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">다음과 같은 경우의 수를 검사</font></span></li><ul><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">buffer[0] != start byte 인 경우</font></span></li><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">buffer[24] != end byte인 경우</font></span></li><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">buffer[0] == start byte &amp;&amp; buffer[24] != end byte 인 경우</font></span></li><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">buffer[0] != start byte &amp;&amp; buffer[24] == end byte 인 경우 </font></span></li><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">buffer[1] ~ buffer[23]중 start byte or end byte가 있는 경우 ex)0x0f, 0x0f, 0x00, 0x01 .... 0x04</font></span></li></ul></ul></ul><div><font face="Segoe UI Symbol" style="font-size: 12pt;"><br/></font></div><div><ul><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">Git hub commit and PR</font></span></li><ul><li><font face="Segoe UI Symbol" style="font-size: 12pt;"><a href="https://github.com/NoNamedSelfDriveing/Drone.git">https://github.com/NoNamedSelfDriveing/Drone.git</a> Github 주소</font></li><li><span style="line-height: 23px;"><font face="Segoe UI Symbol" style="font-size: 12pt;">Drone/Source/2017.10.24_Sbus_decoding 폴더 참고</font></span></li></ul></ul><div><font face="Segoe UI Symbol" size="4"><span style="line-height: 23px;"><br/></span></font></div></div><div><ul><li><font face="Segoe UI Symbol" style="font-size: 12pt;">오늘 새로 배운 것</font></li><ul><li><font face="Segoe UI Symbol">Sbus decoding 하는 방법</font></li><li><font face="Segoe UI Symbol">Sbus data filtering 하는 방법<span style="line-height: 1.45;"> </span></font></li></ul></ul><div><font face="Segoe UI Symbol" style="font-size: 12pt;"><br/></font></div><div><ul><li><font face="Segoe UI Symbol" style="font-size: 12pt;">오늘 고민한 것</font></li><ul><li><font face="Segoe UI Symbol">Sbus data filtering 알고리즘</font></li><ul><li><font face="Segoe UI Symbol">sbus_data_filtering() 함수 구현을 어떻게 할지...</font></li><li><font face="Segoe UI Symbol">통신하는 과정에서 생기는 여러 문제들을 어떻게 해결할지...</font></li><li><font face="Segoe UI Symbol">start byte와 end byte를 잡아내고 온전한 데이터 패킷인 것을 어떻게 확인하는지...</font></li></ul><li><font face="Segoe UI Symbol">sbus data decoding 하는 부분</font></li><li><font face="Segoe UI Symbol">Test 코드 작성</font></li><ul><li><font face="Segoe UI Symbol">어떻게 test buffer를 넣어줄 것 인지?</font></li><li><font face="Segoe UI Symbol">어떤 경우의 수 들이 있는지?</font></li></ul></ul></ul><div><font face="Segoe UI Symbol"><br/></font></div></div><div><ul><li>회고</li><ul><li>사실 진짜 드론개발을 시작하자고 한건 한 2달전이었다...</li><li>2달전부터 기획하고, 설계하고, 카이스트에 인맥이 닿아 박사님의 도움도 받았다.  박사님의 도움을 받으면서 </li></ul></ul><div><span>    <span>    <span>    <span>    <span>    드론을 어떻게 개발할 것 인지, 어떤 부품을 사야하는지 멘토링을 받았고, 부품을 사면서 진짜 개발은 지금으로부터 10월 초부터 시작되었다.</span></span></span></span></span><br/></div><div><span><span>    <span>    <span>    <span>    <span>    부품도 생각보다 늦게왔고, 팀원 모두 처음하는 분야라서, 드론의 프로세서로 쓰이는 STM32 F407보드를 공부하는 것 부터 시작했다.</span></span></span></span></span><br/></span></div><div><span><span>    <span>    <span>    <span>    <span>    AVR과 아두이노 등을 미리 해봤기 때문에 딱히 어렵진 않았고, 인터넷 강의와 예제 소스코드를 보면서 공부를 했다.</span></span></span></span></span><br/></span></div><div><span><span>    <span>    <span>    <span>    <span>    </span></span></span></span></span><br/></span></div><div><ul><li><span style="line-height: 1.45;">박사님께서 조립하는 법, 어떤걸 진행해야 하는지, 어떤 알고리즘이 있고, 어떻게 설계하는지 등등 거의 모든 것들을 전반적으로 멘토링을 해주시면서 </span></li></ul><span style="line-height: 1.45;"><span>    <span>    <span>    <span>    <span>    개발을 하기 시작했다.... 이해하기 어려운 부분도 있지만 그래도 나름대로 재미있다. </span></span></span></span></span></span></div><div><span style="line-height: 1.45;"><br/></span></div><div><ul><li><span style="line-height: 1.45;">앞으로 계속해서 드론 개발일지를 올릴 예정...                          </span><span style="line-height: 1.45;">    </span></li></ul></div></div></div></div><div style="text-align: left;"><br/></div><div><br/></div></span>
</div></body></html> 